Sub CifrarArchivosYEnviarPorCorreo()

    ' Definir las variables
    Dim Contraseña As String
    Dim DirectorioOrigen As String
    Dim DirectorioDestino As String
    Dim ArchivoZip As String
    Dim ArchivoExcel As String
    Dim OutlookApp As Object
    Dim Correo As Object
    Dim Adjunto As Object
    
    ' Configurar las variables
    Contraseña = "contraseña123" ' Cambiar por tu contraseña
    DirectorioOrigen = "C:\ArchivosACifrar" ' Cambiar por el directorio que quieres cifrar
    DirectorioDestino = "C:\Cifrado" ' Cambiar por el directorio donde quieres guardar los archivos cifrados
    ArchivoZip = "C:\Cifrado.zip"
    ArchivoExcel = ThisWorkbook.Path & "\" & ThisWorkbook.Name
    
    ' Calcular la desviación estándar
    Dim DesvEst As Double
    DesvEst = CalcularDesviacionEstandar(Range("A1:A10")) ' Cambiar por el rango de celdas que quieres calcular
    
    ' Cifrar los archivos
    CifrarArchivos DirectorioOrigen, DirectorioDestino, Contraseña
    
    ' Comprimir la carpeta Cifrado en un archivo ZIP
    CrearArchivoZip DirectorioDestino, ArchivoZip, Contraseña
    
    ' Escribir la desviación estándar en la celda debajo de la última celda de la columna
    Range("A" & Rows.Count).End(xlUp).Offset(1, 0).Value = DesvEst
    
    ' Inicializar el objeto de Outlook
    Set OutlookApp = CreateObject("Outlook.Application")
    Set Correo = OutlookApp.CreateItem(0)
    
    ' Agregar el archivo ZIP como adjunto
    Set Adjunto = Correo.Attachments.Add(ArchivoZip)

    ' Configurar el correo electrónico
    Correo.To = "destinatario@ejemplo.com"
    Correo.Subject = "Archivos cifrados"
    Correo.Body = "La desviación estándar es: " & DesvEst & vbCrLf & vbCrLf & "Adjunto se encuentran los archivos cifrados."
    
    ' Agregar el archivo de Excel como adjunto
    Set Adjunto = Correo.Attachments.Add(ArchivoExcel)
    
    ' Enviar el correo electrónico
    Correo.Send

    ' Eliminar el archivo ZIP
    Kill ArchivoZip
    
End Sub

Function CalcularDesviacionEstandar(RangoDatos As Range) As Double
    ' Esta función calcula la desviación estándar de un rango de celdas
    
    Dim Suma As Double
    Dim SumaCuadrados As Double
    Dim N As Integer
    Dim Promedio As Double
    Dim Desv As Double
    
    ' Calcular la suma de los datos y la suma de los cuadrados de los datos
    For Each Celda In RangoDatos
        Suma = Suma + Celda.Value
        SumaCuadrados = SumaCuadrados + Celda.Value ^ 2
        N = N + 1
    Next Celda
    
    ' Calcular el promedio y la desviación estándar
    Promedio = Suma / N
    Desv = Sqr((SumaCuadrados / N) - (Promedio ^ 2))
    
    ' Escribir la desviación estándar al final del rango de datos
    RangoDatos(RangoDatos.Cells.Count + 1).Value = "Desviación estándar: " & Desv
    
    CalcularDesviacionEstandar = Desv
End Function

